<div class="content-wrapper container-xxl p-0" *blockUI="'section-block'">
  <div class="content-body">
    <!-- content-header component -->
    <app-content-header [contentHeader]="contentHeader"></app-content-header>


    <!-- Invoice List -->
    <section class="invoice-list-wrapper">
      <div class="card">

        <!-- Invoice List Header -->
        <div class="row">
          <div class="col-md-6 col-12">
            <div class="d-flex justify-content-between align-items-center m-1">
              <div class="d-flex align-items-center">
                <label class="d-flex align-items-center">Mostrar
                  <select class="form-control mx-25" [(ngModel)]="basicSelectedOption">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                </label>
                <button type="button" [routerLink]="'/tools/register-api/'+driversAPP" class="btn btn-icon btn-info"
                  style="height: 38px; margin-top: -4px;" rippleEffect>
                  <span [data-feather]="'plus'"></span> Agregar</button>
                &nbsp;
                <button type="button" (click)="ExportApi()" class="btn btn-icon btn-primary"
                  style="height: 38px; margin-top: -4px;" rippleEffect>
                  <span [data-feather]="'database'"></span> Exportar</button>
                &nbsp;
                <button type="button" (click)="ImportApi()" class="btn btn-icon btn-warning"
                  style="height: 38px; margin-top: -4px;" rippleEffect>
                  <span [data-feather]="'database'"></span> Importar</button>
                &nbsp;
                <button type="button" (click)="ListadoApis()" class="btn btn-icon btn-dark"
                  style="height: 38px; margin-top: -4px;" rippleEffect>
                  <span [data-feather]="'file'"></span> Generar PDF</button>
              </div>
            </div>
          </div>
          <div class="
              col-md-6 col-lg-4 col-12
              d-flex
              justify-content-start justify-content-md-end
              align-items-center
              offset-lg-2
            ">
            <div class="row pr-1 pb-1 pb-md-0 align-items-center w-100">
              <div class="col-10 col-md-6 pr-0">
                <label class="d-flex align-items-center mb-0 ml-1 ml-md-0"><input [(ngModel)]="searchValue"
                    name="searchValue" type="search" class="form-control" placeholder="Buscar..."
                    (keyup)="filterUpdate($event)" (search)="filterUpdate($event)" /></label>
              </div>
              <div class="col-10 col-md-6 mt-2 ml-1 ml-md-0 mt-md-0">
                <fieldset class="form-group mb-0">
                  <ng-select [items]="status" [(ngModel)]="sDispositivo" bindLabel="name" bindId="id" bindValue="name"
                    bindLabel="name" bindValue="id" placeholder="Seleccione Status"
                    (change)="filterStatus($event)"></ng-select>
                </fieldset>
              </div>
            </div>
          </div>
        </div>
        <!--/ Invoice List Header -->

        <ngx-datatable #tableRowDetails class="bootstrap core-bootstrap" [columnMode]="ColumnMode.force"
          [headerHeight]="40" [footerHeight]="50" [rowHeight]="58" [limit]="10" [rows]="rowData" [scrollbarH]="true">

          <ngx-datatable-row-detail [rowHeight]="350">
            <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
              <div class="ml-75 pl-4 pt-50">
                <div class="col-md-11">
                  <table class="table table-striped border datatable">
                    <thead class="thead">
                      <tr>
                        <th>Hash</th>
                        <th>Funcionalidad</th>
                        <th>Tipo</th>
                        <th>Waf</th>
                        <th>Concurrencia</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>{{ row.id }}</td>
                        <td>{{ row.funcionalidad }}</td>
                        <td>{{ row.tipo }} </td>
                        <td>
                          <div class="badge badge-pill" [ngClass]="{
                            'badge-light-success': row.accion == true,
                            'badge-light-danger': row.accion == false
                          }">
                            {{
                            row.accion == true
                            ? 'Si'
                            : row.accion == false
                            ? 'No'
                            : 'No'
                            }}
                          </div>
                        </td>
                        <td>
                          <div class="badge badge-pill" [ngClass]="{
                            'badge-light-success': row.concurrencia == true,
                            'badge-light-danger': row.concurrencia == false
                          }">
                            {{
                            row.concurrencia == true
                            ? 'Si'
                            : row.concurrencia == false
                            ? 'No'
                            : 'No'
                            }}
                          </div>
                        </td>
                      </tr>
                    </tbody>
                    <thead class="thead">
                      <tr>
                        <th>Retorno</th>
                        <th>Prioridad</th>
                        <th>Consumidores</th>
                        <th>Cache</th>
                        <th>Log</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          <div class="badge badge-pill" [ngClass]="{
                            'badge-light-success': row.retorna == true,
                            'badge-light-danger': row.retorna == false
                          }">
                            {{
                            row.retorna == true
                            ? 'Si'
                            : row.retorna == false
                            ? 'No'
                            : 'No'
                            }}
                          </div>
                        </td>
                        <td>
                          <div class="badge badge-pill" [ngClass]="{
                            'badge-light-info': row.prioridad == '0',
                            'badge-light-warning': row.prioridad == '1',
                            'badge-light-success': row.prioridad == '2'
                          }">
                            {{
                            row.prioridad == '0'
                            ? 'Baja' :
                            row.prioridad == '1'
                            ? 'Mediana'
                            : row.prioridad == '2'
                            ? 'Alta'
                            : 'No'
                            }}
                          </div>
                        </td>
                        <td>
                          <div class="badge badge-pill badge-light-warning">{{ row.consumidores }}</div>
                        </td>
                        <td>
                          <div class="badge badge-pill" [ngClass]="{
          'badge-light-success': row.cache == 1,
          'badge-light-danger': row.cache == 0
        }">
                            {{
                            row.cache == 1
                            ? 'Si'
                            : row.cache == 0
                            ? 'No'
                            : 'No'
                            }}
                          </div>
                        </td>
                        <td>
                          <div class="badge badge-pill" [ngClass]="{
          'badge-light-success': row.logs == true,
          'badge-light-danger': row.logs == false
        }">
                            {{
                            row.logs == true
                            ? 'Activo'
                            : row.logs == false
                            ? 'Inactivo'
                            : 'Inactivo'
                            }}
                          </div>
                        </td>
                      </tr>
                      <tr class="align-middle">
                        <td colspan="5">
                          {{ row.descripcion ? row.descripcion : 'Sin Descripción' }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <p class="card-text text-justify">
                    <br>
                    <code>
             {{ row.query }}
               </code>
                  </p>
                 <hr>

                </div>
              </div>
            </ng-template>
          </ngx-datatable-row-detail>
          <ngx-datatable-column [width]="50" [resizeable]="false" [sortable]="false" [draggable]="false"
            [canAutoResize]="false">
            <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
              <a href="javascript:void(0)" [class.datatable-icon-right]="!expanded"
                [class.datatable-icon-down]="expanded" title="Expand/Collapse Row"
                (click)="rowDetailsToggleExpand(row)">
              </a>
            </ng-template>

          </ngx-datatable-column>
          <ngx-datatable-column name="Funcion" [width]="280">
            <ng-template let-row="row" let-name="value" ngx-datatable-cell-template>
              <div class="d-flex align-items-center">
                <div *ngIf="row.length > 0; else customAvatar">
                  <img class="rounded-circle mr-1" src="{{ row.avatar }}" height="32" width="32"
                    alt="datatable-avatar" />
                </div>
                <ng-template #customAvatar>
                  <div class="avatar mr-1 ml-0" [ngClass]="{
                      'bg-light-success': row.estatus == true,
                      'bg-light-danger': row.estatus == false
                    }">
                    <div class="avatar-content">{{ row.funcion.toUpperCase() | initials }}</div>
                  </div>
                </ng-template>
                <div class="cell-line-height">
                  <span class="font-weight-bold d-block "><strong>{{ row.funcion }}</strong></span>
                  <span class="text-muted font-small-2">
                    <div class="badge badge-pill" [ngClass]="{
                      'badge-light-success': row.entorno == 'calidad',
                      'badge-light-info': row.entorno == 'desarrollo',
                      'badge-light-warning': row.entorno == 'produccion'
                    }">
                    {{row.entorno | uppercase}}
                    </div>
                  </span>
                </div>
              </div>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="Descripcion" prop="descripcion" [width]="350">
            <ng-template let-row="row" ngx-datatable-cell-template>
              {{row.descripcion.slice(0, 60) }}...
            </ng-template>
          </ngx-datatable-column>
          >
          <ngx-datatable-column name="Version" [width]="5">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <div class="badge badge-pill badge-light-info">{{row.version}}</div>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column name="Status" prop="estatus" [width]="5">
            <ng-template let-estatus="value" ngx-datatable-cell-template>
              <div class="badge badge-pill" [ngClass]="{
          'badge-light-success': estatus == true,
          'badge-light-danger': estatus == false
        }">
                {{
                estatus == true
                ? 'Activo'
                : estatus == false
                ? 'Inactivo'
                : 'Inactivo'
                }}
              </div>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="ACCIÓN" [width]="5" [sortable]="false">
            <ng-template ngx-datatable-cell-template let-row="row">
              <div ngbDropdown container="body">
                <button [routerLink]="'/tools/api-details/'+ row.funcion" type="button" class="btn icon-btn btn-sm hide-arrow" rippleEffect>
                  <span [data-feather]="'play'" [class]="'cursor-pointer'"></span>
                </button>
              </div>
            </ng-template>
          </ngx-datatable-column>


        </ngx-datatable>

        <!--/ Invoice List Table -->


      </div>
    </section>
    <!--/ Invoice List -->

  </div>
</div>



<ng-template #ModalEditApis let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="myModalLabel160">Editar Api</h5>
    <button type="button" class="close" (click)="modal.dismiss('Cross click')" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <form class="auth-login-form mt-2">
    <div class="modal-body" tabindex="0" ngbAutofocus>
      <!-- Invoice -->
      <div class="col-xl-12 col-md-12 col-12">
        <!-- Header Starts -->
        <div class="row">

        </div>

      </div>

    </div>
    <div class="modal-footer">
      <button class="btn btn-success" tabindex="4" rippleEffect>Actualizar</button>
      <button type="button" class="btn btn-danger" (click)="modal.close('Accept click')" rippleEffect>Cerrar</button>
    </div>
  </form>

</ng-template>

<ng-template #ModalProbarApi let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="myModalLabel160">Probar Api</h5>
    <button type="button" class="close" (click)="modal.dismiss('Cross click')" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body" tabindex="0" ngbAutofocus>
    <!-- Invoice -->
    <div class="col-xl-12 col-md-12 col-12">
      <!-- Header Starts -->


      <ul ngbNav #navCenter="ngbNav" class="nav-tabs justify-content-center">
        <li ngbNavItem>
          <a ngbNavLink>Laboratorio de Pruebas</a>
          <ng-template ngbNavContent>

            <div class="row">
              <div class="col-xl-6 col-md-6 col-12">
                <div class="form-group">
                  <label for="basicInput">Parametros</label>
                  <input type="text" class="form-control" [ngModelOptions]="{standalone: true}" [(ngModel)]="xparametro"
                    value="{{xparametro}}" id="basicInput" placeholder="Ingrese Parametros" />
                </div>
              </div>
              <div class="col-xl-6 col-md-6 col-12">
                <div class="form-group">
                  <label for="basicInput">Url Api</label>
                  <div class="input-group form-password-toggle mb-2">
                    <input type="text" class="form-control" [ngModelOptions]="{standalone: true}" [(ngModel)]="xentorno"
                      value="{{xentorno}}" placeholder="" [attr.disabled]="true" />
                    <div class="input-group-append" (click)="ejecutarApi()">
                      <span class="input-group-text cursor-pointer btn-success">
                        <span [data-feather]="'play'" [class]="'mr-25'"></span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-6 col-md-6 col-12 mb-1">
                <div class="form-group">
                  <label for="basicInput">Valores</label>
                  <ngx-codemirror
                  [ngModelOptions]="{standalone: true}" 
                  [(ngModel)]="valores"
                  [options]="codeMirrorOptions"
                  ></ngx-codemirror>
                </div>
              </div>
              <div class="col-xl-6 col-md-6 col-12 mb-1">
                <div class="form-group">
                  <label for="basicInput">Resultado</label>
                  <div style="width:100%; height:300px; overflow: scroll;">
                    <div id="xrs"></div>
                  </div>
                </div>
              </div>
            </div>

          </ng-template>
        </li>
        <li ngbNavItem>
          <a ngbNavLink>Fragmento de Codido</a>
          <ng-template ngbNavContent>
            <fieldset class="form-label-group mb-0">
              <textarea [ngModelOptions]="{standalone: true}" [(ngModel)]="codeTypeJs"
                  value="{{codeTypeJs}}" #textLength [maxlength]="99999999999"
                  class="form-control char-textarea" id="textarea-counter" rows="17"
                  placeholder="Ejemplo de ejecución"></textarea>
              <label for="textarea-counter">Ejemplo de ejecución</label>
          </fieldset>
          <small class="textarea-counter-value float-right"><span *ngIf="textLength" class="char-count">{{
                  textLength.value.length
          }}</span>
              <span *ngIf="!textLength" class="char-count">0 </span>
          </small>
          </ng-template>
        </li>
      </ul>
      <div [ngbNavOutlet]="navCenter" class="mt-2"></div>




    </div>

  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-success" (click)="ejecutarApi()" rippleEffect>Probar <span [data-feather]="'play'" [class]="'mr-25'"></span></button>
    <button type="button" class="btn btn-danger" (click)="modal.close('Accept click')" rippleEffect>Cerrar</button>
  </div>

</ng-template>

